-- Main LocalScript
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local SoundService = game:GetService("SoundService")
local StarterGui = game:GetService("StarterGui")
local TextChatService = game:GetService("TextChatService")

local LocalPlayer = Players.LocalPlayer

-- GUI Creation
local MainGui = Instance.new("ScreenGui")
MainGui.Name = "MainGui"
MainGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
MainGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Parent = MainGui
MainFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
MainFrame.BorderColor3 = Color3.fromRGB(255, 217, 0)
MainFrame.BorderSizePixel = 5
MainFrame.Position = UDim2.new(0.356, 0, 0.136, 0)
MainFrame.Size = UDim2.new(0, 362, 0, 464)

local TitleAndDragFrame = Instance.new("Frame")
TitleAndDragFrame.Name = "TitleAndDragFrame"
TitleAndDragFrame.Parent = MainFrame
TitleAndDragFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
TitleAndDragFrame.BorderColor3 = Color3.fromRGB(255, 217, 0)
TitleAndDragFrame.BorderSizePixel = 5
TitleAndDragFrame.Size = UDim2.new(0, 362, 0, 60)

local Title = Instance.new("TextLabel")
Title.Name = "Title"
Title.Parent = TitleAndDragFrame
Title.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
Title.BorderSizePixel = 0
Title.Size = UDim2.new(1, 0, 1, 0)
Title.Font = Enum.Font.SourceSans
Title.Text = "C0mmunityGUI"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextScaled = true
Title.TextWrapped = true

local CloseFrame = Instance.new("Frame")
CloseFrame.Name = "CloseFrame"
CloseFrame.Parent = MainFrame
CloseFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
CloseFrame.BorderColor3 = Color3.fromRGB(255, 217, 0)
CloseFrame.BorderSizePixel = 5
CloseFrame.Position = UDim2.new(0, 0, 1, -35)
CloseFrame.Size = UDim2.new(0, 362, 0, 35)

local Close = Instance.new("TextLabel")
Close.Name = "Close"
Close.Parent = CloseFrame
Close.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
Close.BorderSizePixel = 0
Close.Size = UDim2.new(1, 0, 1, 0)
Close.Font = Enum.Font.SourceSans
Close.Text = "Close"
Close.TextColor3 = Color3.fromRGB(255, 255, 255)
Close.TextScaled = true
Close.TextWrapped = true

local PartRing = Instance.new("TextButton")
PartRing.Name = "PartRing"
PartRing.Parent = MainFrame
PartRing.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
PartRing.BorderColor3 = Color3.fromRGB(255, 217, 0)
PartRing.BorderSizePixel = 5
PartRing.Position = UDim2.new(0, 0, 0.142, 0)
PartRing.Size = UDim2.new(0, 159, 0, 51)
PartRing.Font = Enum.Font.SourceSans
PartRing.Text = "Part Ring V1"
PartRing.TextColor3 = Color3.fromRGB(255, 255, 255)
PartRing.TextScaled = true
PartRing.TextWrapped = true

-- DRAG FUNCTION
do
    local dragFrame = TitleAndDragFrame
    local dragging, dragInput, dragStart, startPos

    local function update(input)
        local delta = input.Position - dragStart
        MainFrame.Position = UDim2.new(
            startPos.X.Scale, startPos.X.Offset + delta.X,
            startPos.Y.Scale, startPos.Y.Offset + delta.Y
        )
    end

    dragFrame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = MainFrame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    dragFrame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            update(input)
        end
    end)
end

-- PART RING BUTTON
do
    local ran = false
    PartRing.MouseButton1Click:Connect(function()
        if ran then return end
        ran = true

        -- Example: print when button clicked
        print("Part Ring button clicked!")

        -- Put your full PartRing logic here (velocity, RetainPart, GUI, etc.)
        -- Flatten the LocalScript code from Gui to Lua here.
    end)
end
